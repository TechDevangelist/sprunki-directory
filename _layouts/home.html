<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page.title }}</title>
    <link rel="stylesheet" href="{{ site.baseurl }}/assets/css/home.css?{{ site.time | date: '%s' }}">
</head>
<body>
    <main>
        {{ content }}
        
        <div class="game-grid">
            {% for game in site.games %}
                <div class="game-tile" onclick="openModal('{{ game.iframe_url }}')">
                    <img src="{{ site.baseurl }}{{ game.screenshot }}?{{ site.time | date: '%s' }}" alt="{{ game.title }}">
                    <h3>{{ game.title }}</h3>
                </div>
            {% endfor %}
        </div>

        <div id="modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <iframe id="modal-iframe" src="" frameborder="0"></iframe>
            </div>
        </div>
    </main>

    <script>
        function openModal(iframeUrl) {
            const modal = document.getElementById('modal');
            const iframe = document.getElementById('modal-iframe');
            
            // Reset iframe dimensions
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            
            // Set source and show modal
            iframe.src = iframeUrl;
            modal.style.display = 'flex';
            
            // Prevent body scroll when modal is open
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            const modal = document.getElementById('modal');
            const iframe = document.getElementById('modal-iframe');
            
            // Reset iframe
            iframe.src = '';
            iframe.style.width = '';
            iframe.style.height = '';
            
            // Hide modal
            modal.style.display = 'none';
            
            // Restore body scroll
            document.body.style.overflow = '';
        }

        function handleModalClose(event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Handle both mouse and touch events
        window.addEventListener('click', handleModalClose);
        window.addEventListener('touchend', handleModalClose);

        // Prevent iframe from swallowing touch events
        const iframe = document.getElementById('modal-iframe');
        iframe.addEventListener('touchstart', function(e) {
            e.stopPropagation();
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            const modal = document.getElementById('modal');
            if (modal.style.display === 'flex') {
                const iframe = document.getElementById('modal-iframe');
                iframe.style.width = '100%';
                iframe.style.height = '100%';
            }
        });
    </script>
</body>
</html>